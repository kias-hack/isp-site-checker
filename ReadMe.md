# ISP Site Checker

Приложение для мониторинга доступности веб-доменов из ISPManager.

## Описание

Сервис периодически проверяет доступность доменов и их поддоменов, отправляет уведомления на email при обнаружении что сайт открыт или HTTP ошибка. Список доменов получается из ISPManager через утилиту mgrctl. Проверка выполняется напрямую по IP-адресу, минуя DNS.

## Запуск

```bash
go run cmd/app/main.go -config config/config.toml [-debug]
```

## Конфигурация

```toml
scrape_interval = "60s"
mgrctl_path = "/usr/local/mgr5/sbin/mgrctl"
recipient = "admin@example.com"

[smtp]
username = "user@example.com"
password = "password"
host = "smtp.example.com"
port = 465
from = "noreply@example.com"
```

## TODO

### Улучшения
- Добавить операционные теги в логирование (op: "notification", op: "check")
- Добавить автотест проверки ограничения частоты отправки уведомлений
- Добавить автотест проверки отправки уведомления о восстановлении доступности

### Тестирование notifier
- Автотест отслеживания состояния сайта (fail → success → не шлём лишнее, success после fail — шлём восстановление)
- Автотест дедупликации (не слать повторное уведомление об одном и том же fail/success в рамках окна)

### Баги
- Обработать дублирование поддоменов (когда поддомен создан отдельно в панели)
- Обработать поддомены при поддоменности через внутреннюю папку